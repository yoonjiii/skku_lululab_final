<img src="readme_imgs/readme_img6.png" width="600"/>

### I. 프로젝트 수행 배경 및 목적
* 배경:  현재 룰루랩은 빅데이터 기술을 활용하여 화장품 전성분 및 제형을 분석하고, 피부 측정 결과에 따라 피부에 맞는 화장품을 추천하는 인공지능 제품 추천 서비스를 제공하고 있다. 화장품의 전성분을 분석하기 위해서는 화장품 성분 데이터 확보가 필수적이다.
  화장품 성분 정보를 수기로 작성할 수도 있지만, 매일같이 수십, 수백 개의 신상 화장품이 출시되고 있는 상황에서는 시간 면, 비용 면에서 매우 비효율적이다. 따라서 OCR 기술을 이용하여 화장품 용기에 적혀 있는 화장품 성분 정보를 수집할 수 있는 시스템을 개발하게 되었다.
* 목표: 화장품 포장 상자 또는 용기의 이미지로부터 성분 텍스트를 인식해 이를 성분사전과 매칭함으로써 화장품의 성분정보를 수집하는 시스템 개발
<img src="readme_imgs/readme_img7.png" width="600"/>
<img src="readme_imgs/readme_img8.png" width="600"/>

## 데모 안드로이드 애플리케이션
구현 완료한 안드로이드 애플리케이션의 동작 시나리오는 다음과 같다.
1. 갤러리에서 이미지를 불러온다. 크롭기능이 없으므로 이미 크롭되어 있는 이미지를 불러와야 한다. 불러온 이미지는 base64로 인코딩되어 json object에 저장된다. 
2. 화장품 이름으로 검색하는지, 화장품 성분표로 검색하는지 옵션을 선택한다. 옵션 선택 결과도 json object에 저장된다.
3. 성분표가 한글로 되어 있는지, 영어로 되어 있는지, 언어를 선택한다. 언어 선택 결과도 마찬가지로 json object에 저장된다. 화장품 이름으로 검색하기를 선택했다면 언어 선택은 하지 않아도 된다. 
4. "결과 확인" 버튼을 누르면 저장한 json object의 내용이 string으로 변환되어 서버로 전송된다.
   + 화장품 이름으로 검색하는 경우: 이미지에서 인식한 텍스트가 화장품 이름이므로 이를 화장품 데이터베이스에서 찾고, 그 화장품의 성분정보를 알아낸다. 만약 화장품 데이터베이스에 없는 경우 "no data"를 반환하고, 안드로이드 앱에서 성분표로 검색해달라는 문구를 표시한다.
   + 성분표로 검색하는 경우: 언어 정보에 따라 다르게 동작한다. 이미지에서 인식한 텍스트는 화장품의 성분표이며, 이를 후처리 코드를 통해 성분사전과 매칭한다.  
5. 서버에서 결과를 받는다. String을 JsonArray로 변환하고 파싱한 후, 화면에 ListView를 이용해 표시한다. 리스트에는 성분명, 효능, 위험도를 표기한다.
<img src="readme_imgs/readme_img5.png" width="300"/>

<img src="readme_imgs/readme_img4.png" width="500"/>


 ## 후처리
 
 `app.py`는 앱에서 전송한 정보를 받아 성분사전매칭을 진행한 뒤 그 결과를 다시 앱으로 전송하는 프로그램입니다.
 `app.py`와 필요한 파일을 서버에 올린 뒤에 이 파일을 실행시키면 됩니다. 
 ```
 python app.py
 ```
 
 ### Requirements
 `app.py`를 실행하기 위해 필요한 파일들입니다.
 + ### cosmetic_DB.xlsx
   이미 성분정보가 수집된 화장품들에 대한 정보가 딤긴 파일이자, 화장품 이름과 각 화장품에 포함된 성분들이 정리된 파일입니다.  
   '화장품 이름으로 검색하기' 옵션을 선택했을 때, 화장품 이름이 포함된 이미지에서 OCR로 텍스트를 인식한 뒤, 추출한 텍스트를 이 파일 안에서 찾습니다. 
   만약 찾는다면 이미 성분정보를 수집한 화장품이므로 바로 해당 화장품의 성분정보를 제공합니다. 
   만약 찾지 못한다면 아직 성분정보를 수집하지 못했거나 OCR 인식에서 오류가 있었던 것이므로 'no data'를 반환하고, 화장품 이름이 아닌 화장품 성분표로 다시 검색하도록 합니다.  
   엑셀 파일에는 2개의 열이 있습니다. `name` 열에는 화장품 이름이, `ingredient list` 열에는 각 화장품에 포함된 성분이 기록되어 있습니다.
   <img src="/readme_imgs/readme_img1.jpg">
 + ### frequency_dictionary_kor_ingredients.txt
   이 파일은 한글 성분표에 대한 성분사전매칭에 사용됩니다. 각 성분들의 빈도수가 정리된 파일입니다.  
   한글 성분표에 대한 성분사전매칭에서 symspell이 사용되는데 symspell은 어떤 문자열의 오타를 수정하기 위해서 max_editdistance 내의 후보군을 만들고, 그 중 가장 편집거리가 적으면서, 빈도수가 높은 것을 최종 결과로 선택합니다. 본 프로젝트에서는 각 성분들의 빈도수를 파악하기에 자료가 부족했기 때문에 모두 1로 설정했습니다. 그러나 빈도수가 모두 같기 때문에 가장 작은 편집거리를 가진 후보군이 여러 개 나올 경우 어떤 후보군을 선택해야 하는지 판단하는 과정이 필요합니다. 이를 위해 symspell과 diff()를 모두 사용했습니다. symspell 결과를 가지고 diff()를 통해 가장 유사한 문자열을 찾을 수 있도록 했습니다. 만약 시중에 판매되는 화장품 속 성분들의 빈도수를 파악할 수 있다면 해당 정보가 이 파일에 담겨야 하며, 이를 통해 매칭 정확도를 더 높일 수 있을 것입니다.
   ```
   "성분명 빈도수"
   
   가공소금 1
   가지열매추출물 1
   구멍쇠미역추출물 1
   루핀아미노산 1
   류신 1
   ...
   ```
  + ### ingre.xlsx
    영어 성분표에 대한 성분사전 매칭에 사용되는 성분사전입니다. 
    기존에 룰루랩에서 제공받은 ingredients.xlsx를 수정했습니다. `eng_name`열에 있는 데이터를 소문자로 바꾼 `lower`열을 추가했습니다. 영어성분표에 대한 성분사전 매칭에서는 OCR 결과를 모두 소문자로 바꾼 다음, `lower`열에 있는 데이터와 비교하도록 했습니다.
    <img src="/readme_imgs/readme_img2.jpg">
  
  + ### ingre_kor.xlsx
    한글 성분표에 대한 성분사전 매칭에 사용되는 성분사전입니다.
    기존에 룰루랩에서 제공받은 ingredients.xlsx를 수정했습니다. eng_name 열과 other_name 열을 없앴습니다.
    <img src="/readme_imgs/readme_img3.jpg">
